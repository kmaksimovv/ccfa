[globals](+)

[office]
exten => 1234,1,AGI(agi:async)
exten => _XXX,1,NoOp()
exten => _XXXX,1,Dial(SIP/${EXTEN})
exten => 123,1,Goto(ivr-mrcp,ivr,1)
exten => 124,1,Goto(xml-mrcp,s,1)

exten => 126,1,NoOp(CONTEXT: ${CONTEXT})
  same => n,Answer()	
  same => n,ExecIf($[${CALLERID(num)}=1001]?SayDigits(12345678))
  same => n,SayAlpha(55555555)

exten => 127,1,Playback(hello-world)
exten => 128,1,Playback(zombies&hello-world)
exten => 129,1,Goto(inbound,s,1)
exten => 500,1,Goto(robovoice,${EXTEN},1)
exten => 501,1,Goto(robovoice-ext,s,1)
exten => 502,1,AGI(agi:async)

exten => 130,1,Answer()
	same => n,MusicOnHold()

exten => 205,1,Set(test=qwertyu12345)
exten => 205,n,Verbose(${FILTER(123456789,${test})})
exten => 131,1,Macro(dial_out)


exten => 104,1,Set(FEE=${fee})
exten => 104,2,Set(_FIE=${fie})
exten => 104,3,Set(__FUM=${fum})
exten => 104,4,Dial(Local/105)

exten => 105,1,NoOp(${FEE})
exten => 105,2,NoOp(${FIE})
exten => 105,3,NoOp(${FUM})
exten => 105,4,Dial(Local/106)

exten => 106,Set(ActionID=${CHANNEL(actionid)})
same => n,NoOp(ActionID=${ActionID})


exten => s,1,Answer
exten => s,2,Dial(local/200@internals,30,r)
exten => s,3,NoOp(!!!!!!!!!!!inbound!!!!!!)
exten => s,4,Playback(zombies)
exten => s,5,Hangup

exten => 201,1,Answer()
  same => n,Playback(/var/lib/asterisk/sounds/ivr/ivr111)
  same => n,Playback(/var/lib/asterisk/sounds/ivr/ivr22)
exten => 202,1,NoOp()
  same => n,Dial(SIP/gars/${EXTEN})	


[internals]
exten => 200,1,NoOp(!!!!internals!!!)
exten => 200,2,Dial(SIP/1001)
exten => 200,102,Playback(hello-world)

[ivr-mrcp]
exten => ivr,1,Answer
exten => ivr,n,Wait(0.5)
exten => ivr,n,MRCPSynth(Добро пожаловать в компанию Рога и Копыта!,v(maria))
exten => ivr,n,MRCPRecog(ivr/grammar-sales.srgs,t(5000)f(synth/ivr-main-promt)b)
exten => ivr,n,AGI(agi://10.0.0.1/nlsml-wrapper,ivr,${RECOG_RESULT})
exten => ivr,n+5(tech),MRCPSynth(Техотдел,v(vladimir))
exten => ivr,n,GoToIf($["${ALARM}" = "1"]?alarm:norm)
exten => ivr,n(alarm),Playback(synth/tech-alarm-notification)
exten => ivr,n(norm),MRCPRecog(ivr/grammar-sales.srgs,t(5000)f(synth/ivr-tech-promt)b)
exten => ivr,n,AGI(agi://10.0.0.1/nlsml-wrapper,tech,${RECOG_RESULT})

exten => ivr-dictate,n,MRCPSynth(${DICTATE_TEXT},v(${DICTATE_VOICE})w(synct/${DICTATE_NAME}.ulaw))

[xml-mrcp]
;exten => s,1,Answer
;exten => s,n,SynthAndRecog(<?xml version=\"1.0\"?><speak version=\"1.0\"
;xmlns=\"http://www.w3.org/2001/10/synthesis\" xmlns:xsi=\"http://www.
;w3.org/2001/XMLSchema- instance\" xsi:schemaLocation=\"http://www.
;w3.org/2001/10/synthesis http://www.w3.org/TR/speech- synthesis/synthesis.
;xsd\" xml:lang=\"ru-RU\">Пожалуйста выберите цвет: для красного нажмите
;1 <break/> для зеленого нажмите 2 <break/> для голубого нажмите 3 </
;speak>,<?xml version=\"1.0\"?><grammar

;xmlns=\"http://www.w3.org/2001/06/grammar\" version=\"1.0\" mode=\"dtmf\"
;tag- format=\"semantics/1.0-literals\" root=\"color\"><rule id=\"color\"><oneof><item>1<tag>красный</tag></item><item>2<tag>зеленый</
;tag></item><item>3<tag>голубой</tag></item> </one-of></rule></
;grammar>,t=5000&b=1&ct=0.7)
;exten => s,n,Verbose(1, ${RECOG_STATUS}, ${RECOG_COMPLETION_CAUSE},${RECOG_RESULT})
;exten => s,n,Hangup


exten => s,1,Answer()
exten => s,n,SynthAndRecog(Пожалуйста выберите цвет)
exten => s,n,Verbose(1, ${RECOG_STATUS}, ${RECOG_COMPLETION_CAUSE}, ${RECOG_RESULT})
exten => s,n,Hangup

[robovoice]
exten => _XXX,1,NoOp()
same => n,Set(__CALL_TYPE=auto)
same => n,Set(__CALL_F_CL=1)
same => n,Set(CHANNEL(accountcode)=robovoice)
same => n,Set(CHANNEL(hangup_handler_push)=hangup_office,s,1)
;same => n,Macro(start,OUT)
;same => n,Macro(mixmonitor,${EXTEN})

same => n,UserEvent(!!!!!!!!!!!BossCalled,${CALLERID(num)}, CONTEXT:${CONTEXT}!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!)
same => n,UserEvent(?????????????????????????CAMP_PARM_OUT,SRC:SRC:${FIRST_CID},DST:${FIRST_NUMBER},ACCOUNTCODE:${CHANNEL(accountcode)},CHANNEL:${CHANNEL(name)},START:${STRFTIME(,,%Y-%m-%d %H\:%M\:%S)},UNIQUEID:${UNIQUEID},LINKEDID:${CHANNEL(linkedid)},DIRECT:${DIRECT},SCRIPT_ID:${SCRIPT_ID},CONTACT_ID:${CONTACT_ID},CAMPAIGN_ID:${CAMPAIGN_ID},USER_ID:${USER_ID})

same => n,SIPAddHeader(X-DOMAIN:${DOMAIN})
same => n,Macro(dial_out,${EXTEN},60,b(set_var^s^1))
same => n,Hangup()


[macro-dial_out] ;1-Exten, 2-TimeOut, 3-Option
exten => s,1,NoOp(CALLERID: ${CALLERID(all)})
same => n,Set(${IF($[${LEN(${CALLERID(num)})} = 11]?CALLERID(num)=${CALLERID(num)}:CALLERID(num)=74952521199)})
same => n,GotoIf($[$["${REGEX("[78]" ${ARG1:0:1})}" = "1"] & ["${REGEX("[34589]" ${ARG1:1:1})}" = "1"]]?rus)

same => n,NoOp(<<<<<<   INTERNATIONAL   >>>>>>)
same => n,ExecIf($[$["${CL_TR}" != ""] & $["${USE_TR}" = "1"]]?Set(CHANNEL(peeraccount)=${CL_TR}):Set(CHANNEL(peeraccount)=gars))
same => n,ExecIf($[$["${CL_TR}" != ""] & $["${USE_TR}" = "1"]]?Dial(SIP/${CL_TR}/${ARG1},${ARG2},${ARG3}M(answ)L(1800000)):Dial(SIP/gars/${ARG1},${ARG2},${ARG3}M(answ)L(1800000)))
same => n,ExecIf($[$["${CL_TR}" != ""] & $["${USE_TR}" = "1"]]?MacroExit())
same => n,ExecIf($[$["${DIALSTATUS}" != "CONGESTION"] & $["${DIALSTATUS}" != "CHANUNAVAIL"]]?MacroExit())

same => n,Set(CHANNEL(peeraccount)=beeline)
same => n,Dial(SIP/beeline/${ARG1},${ARG2},${ARG3}M(answ)L(1800000)))
same => n,MacroExit()

same => n(rus),NoOp(<<<<<<   RUSSIA   >>>>>>)
same => n,ExecIf($[$["${CL_TR}" != ""] & $["${USE_TR}" = "1"]]?Set(CHANNEL(peeraccount)=${CL_TR}):Set(CHANNEL(peeraccount)=gars))
same => n,ExecIf($[$["${CL_TR}" != ""] & $["${USE_TR}" = "1"]]?Dial(SIP/${CL_TR}/7${ARG1:1},${ARG2},${ARG3}M(answ)L(1800000)):Dial(SIP/gars/7${ARG1:1},${ARG2},${ARG3}M(answ)L(1800000)))
same => n,ExecIf($[$["${CL_TR}" != ""] & $["${USE_TR}" = "1"]]?MacroExit())
same => n,ExecIf($[$["${DIALSTATUS}" != "CONGESTION"] & $["${DIALSTATUS}" != "CHANUNAVAIL"]]?MacroExit())

same => n,NoOp(DIALSTATUS: ${DIALSTATUS}, HANGUPCAUSE:${HANGUPCAUSE})
same => n,Set(CHANNEL(peeraccount)=beeline)
same => n,Dial(SIP/beeline/7${ARG1:1},${ARG2},${ARG3}M(answ)L(1800000)))
same => n,MacroExit()

[set_var]
exten => s,1,NoOp(context: ${CONTEXT})

[robovoice-ext]
exten => s,1,NoOp()
same => n,Set(__CALL_TYPE=auto)
same => n,Answer()
;same => n,GotoIf($["${USER_ID}" = "2fd9f5c1-f1df-4a2b-a085-29f6e42f52e9"]?agi)

same => n,AMD()
same => n,NoOp(      <<<  ${AMDSTATUS}  ${AMDCAUSE}  >>>)
same => n,Set(SHARED(AMDSTATUS,${CUT(CHANNEL(name),\;,1)}\;2)=${AMDSTATUS})
same => n,Set(SHARED(AMDCAUSE,${CUT(CHANNEL(name),\;,1)}\;2)=${AMDCAUSE})
;same => n,GotoIf($["${AMDSTATUS}" = "MACHINE"]?mach)
;same => n(agi),AGI(agi:async,OUT)
same => n(agi),AGI(agi:async)
same => n,NoOp(<<<<<< BREAK >>>>>>)
same => n,Hangup()
same => n(mach),Hangup()

